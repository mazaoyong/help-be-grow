<!DOCTYPE html>
<html lang="zh-cmn-Hans">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="referrer" content="always">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="format-detection" content="telephone=no">
    <meta http-equiv="cleartype" content="on">
    <meta name="keywords" content="{{ keywords }}" />
    <meta name="description" content="{{ description }}" />
    <title>{% block page_title %}{{ title }}{% endblock %}</title>
    <link rel="icon" href="//img01.yzcdn.cn/v2/image/yz_fc.ico">

    {# 全局样式 #}
    {% block base_style %}
      {{ loadCss('version_h5_css.base') | safe }}
    {% endblock %}

    {# 页面级样式 #}
    {% block page_style %}
    {% endblock %}

    {# debug 脚本 #}
    {% block debug_script %}
      {% include './tpl/debug_script.html' %}
    {% endblock %}

    <script>
      window._global = {{ _global | safe }}
    </script>
  </head>
  <body class="{{ globalTheme }}">
    {# 页面内容 #}
    {% block page_content %}
      <div id="app"></div>
    {% endblock %}

    {# 全局脚本 #}
    {% block base_script %}
      {% include './tpl/sentry_script.html' %}
      {{ loadJs('version_h5_js.base') | safe }}
      {{ loadJs('version_h5_js.dll') | safe }}
    {% endblock %}

    {# 页面级脚本 #}
    {% block page_script %}
    {% endblock %}

    <script>
      function replaceImgCdn(target) {
        try {
          if (!target || target.nodeName.toUpperCase() !== 'IMG') return;
          var src = target.src || '';
          if (src.indexOf('https://img.yzcdn.cn/') === 0) {
            target.src = src.replace(/^https:\/\/img\.yzcdn\.cn\//, 'https://img01.yzcdn.cn/');
          }
        } catch(_) {}
      }

      document.body.addEventListener(
        'error',
        function(e) {
          replaceImgCdn(e.target);
        },
        true
      );

      document.querySelectorAll('img').forEach(function(target) {
        replaceImgCdn(target);
      });
    </script>

  </body>
</html>
